(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);$(function(){'use strict';$('.image-url-generator').each(function(){var $this=$(this);var $form=$this.find('form');var $filterMethodField=$form.find('select#id_filter_method');var $widthField=$form.find('input#id_width');var $heightField=$form.find('input#id_height');var $closenessField=$form.find('input#id_closeness');var $result=$this.find('#result-url');var $loadingMask=$this.find('.loading-mask')
var $preview=$this.find('img.preview');var $sizeNote=$('#note-size')
var generatorUrl=$this.data('generatorUrl');function formChangeHandler(){var filterSpec=$filterMethodField.val();$loadingMask.addClass('loading');if(filterSpec=='original'){$widthField.prop('disabled',true);$heightField.prop('disabled',true);$closenessField.prop('disabled',true);}else if(filterSpec=='width'){$widthField.prop('disabled',false);$heightField.prop('disabled',true);$closenessField.prop('disabled',true);filterSpec+='-'+$widthField.val();}else if(filterSpec=='height'){$widthField.prop('disabled',true);$heightField.prop('disabled',false);$closenessField.prop('disabled',true);filterSpec+='-'+$heightField.val();}else if(filterSpec=='min'||filterSpec=='max'||filterSpec=='fill'){$widthField.prop('disabled',false);$heightField.prop('disabled',false);if(filterSpec=='fill'){$closenessField.prop('disabled',false);filterSpec+='-'+$widthField.val()+'x'+$heightField.val()+'-c'+$closenessField.val()}else{$closenessField.prop('disabled',true);filterSpec+='-'+$widthField.val()+'x'+$heightField.val();}}
if($widthField.val()>$(window).width()){$sizeNote.show();}else{$sizeNote.hide();}
$.getJSON(generatorUrl.replace('__filterspec__',filterSpec)).done(function(data){$result.val(data.url);$preview.attr('src',data.preview_url);$loadingMask.removeClass('loading');}).fail(function(data){$result.val(data.responseJSON.error);$preview.attr('src','');$loadingMask.removeClass('loading');});}
$form.change($.debounce(500,formChangeHandler));$form.keyup($.debounce(500,formChangeHandler));formChangeHandler();$result.click(function(){$(this).select();});});});